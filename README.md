# ファイルナビ（Google Apps Script / GAS）

Google Drive の **フォルダURL/フォルダID** からファイル一覧を取得し、クリックで **Driveプレビュー（iframe）** を表示するシンプルなWebアプリです。  
GAS（Google Apps Script）を触ったことがない人でも、自分の環境に導入できる手順をまとめています。

---

## これは何をするアプリ？

- Google Drive の特定フォルダ配下の **ファイル／フォルダ一覧** を表示
- **フォルダをクリックするとそのフォルダに移動**（戻る操作あり）
- ファイルをクリックすると右側に **Drive標準のプレビュー（iframe）** を表示
- 「フォルダを選ぶ」から **フォルダツリーで直接選択**
  - マイドライブ / 共有ドライブ / 共有アイテムに対応
- フォルダ読み込み後、入力欄右の **「☆」** でお気に入り登録／解除（即保存）
- サイドバーの **「お気に入り」** からワンクリックで移動（折りたたみ可）
- 設定（お気に入り、ソート、件数制限、履歴、テーマ）は **ユーザー単位** で保存（`UserProperties`）

---

## 必要なもの

- Googleアカウント
- ブラウザ（Chrome推奨）
- 対象のDriveフォルダにアクセスできる権限

---

## GAS / Apps Scriptって何？（超ざっくり）

- **Google Apps Script（GAS）**: Googleが用意している、Googleサービス（Drive / Gmail / スプレッドシート等）を自動化できるスクリプト環境です。
- **Apps Scriptプロジェクト**: スクリプト（`.gs`）や画面（`.html`）をまとめた単位です。今回のアプリは「Webアプリ」として公開してブラウザから使います。

---

## 必要なサービス / API（ここだけ先に確認）

このアプリが使う主なサービスは次の通りです。

- **標準（最初から使える）**
  - `HtmlService`（Web画面を返す）
  - `PropertiesService`（ユーザー別設定の保存）
  - `DriveApp`（ルートフォルダID取得、フォルダ名取得など）
- **要有効化（重要）**
  - **高度なGoogleサービス: Drive API**（`Drive.Files.list()` / `Drive.Drives.list()` を使用）
  - **Google Cloud側: Google Drive API**（上とセットで有効化が必要）
- **任意（`clasp`でローカル同期したい人だけ）**
  - **Apps Script API**（`clasp`利用に必要な場合があります）

---

## データの取り扱い・安全性について

- このアプリは、Google Drive 上の **ファイル／フォルダのメタデータ**
  （名前・更新日時・サイズ・ID 等）を取得して画面に表示します。
- ファイルの中身を外部サーバへ送信する処理は含みません。
  - プレビューは **Google Drive の標準プレビュー** を iframe で表示します。
- お気に入りや設定値は `PropertiesService.getUserProperties()` に保存され、
  **Apps Script 環境の外部には送信されません**。

---

## このリポジトリにあるファイル（何をどこに置く？）

このリポジトリは **GASプロジェクト内の2ファイル** に相当します。

- `Code.gs`
  - サーバ側（`doGet()` / Drive一覧取得 / 設定の保存など）
- `Index.html`
  - 画面（UI）とクライアント側の処理（`google.script.run` で `Code.gs` を呼ぶ）

---

## 導入手順（GASが分からない人向け）

### 1) Apps Script プロジェクトを作成する

1. Google Drive を開く
2. **新規** → **その他** → **Google Apps Script**（見当たらなければ「Apps Script」で検索）
3. プロジェクト名を任意で設定（例：`File_Navi`）

### 2) ファイルを作成して貼り付ける

1. エディタ左のファイル一覧で、既存の `Code.gs` を開く  
   - このリポジトリの `Code.gs` の内容を **全てコピーして貼り付け**
2. 左の「＋」→ **HTML** を選び、ファイル名を **`Index`** にする（重要）
   - このリポジトリの `Index.html` の内容を **全てコピーして貼り付け**

補足：

- `doGet()` が `HtmlService.createHtmlOutputFromFile('Index')` を呼ぶため、HTMLファイル名は **`Index`** である必要があります（拡張子はGAS側で自動）。
- `Code.gs` のファイル名は基本的に何でも動きますが、初心者向けにこのREADMEでは `Code.gs` のままにしています。

### 3) （重要）高度なGoogleサービス（Drive API）を有効化する

このアプリは `Drive.Files.list()` / `Drive.Drives.list()` を使用します。これは **「高度なGoogleサービス」** を有効化しないと動きません。

1. Apps Script エディタで左メニューの **「サービス」**（パズルピースのようなアイコン）を開く  
   - 旧UIの場合は **「プロジェクトの設定」** 内に「Googleの高度なサービス」があります
2. **「＋ サービスを追加」** → **Drive API** を選び、追加して **ON** にする
3. 併せて、関連する **Google Cloud プロジェクト側** のAPIも有効化します  
   - 同じ画面に出てくる「Google Cloud プロジェクト」へのリンクから開き、**Google Drive API** を **有効化**

よくある症状：

- `Drive is not defined` / `Drive.Files` が無い → ほぼ確実に上記の有効化漏れです

### 4) 実行権限（初回承認）を通す

1. Apps Script上で `Code.gs` の任意の関数を実行（例：`getAppInfo` など）
2. 初回のみ、Googleから権限承認が求められるので許可します

このアプリが扱う可能性のある権限（概念）：

- Driveのファイル/フォルダの閲覧（一覧取得・共有ドライブ含む）
- ユーザー設定の保存（UserProperties）

※ 実際の承認画面に出る文言はGoogle側の表示に従います。

### 5) Webアプリとしてデプロイする

1. 右上の **「デプロイ」** → **「新しいデプロイ」**
2. 種類を **ウェブアプリ** にする
3. 設定例：
   - **実行するユーザー**：自分（推奨）
   - **アクセスできるユーザー**：まずは「自分のみ」（動作確認が安全）
4. デプロイ後に表示される **WebアプリURL** を開く

補足（更新のしかた）：

- `Code.gs` / `Index.html` を直しただけでは、既に配布中のWebアプリに反映されないことがあります。  
  その場合は **「デプロイ」→「デプロイを管理」** から、対象デプロイを **編集** して **新しいバージョン** を選び、更新してください。

---

## 使い方（クイック）

1. 左の入力欄に **フォルダURL** または **フォルダID** を入れて「読み込み」
2. 一覧からファイルをクリック → 右にプレビュー
3. フォルダをクリック → そのフォルダに移動
4. 「フォルダを選ぶ」→ ツリーで選択（共有ドライブ/共有アイテムも）
5. お気に入りに入れたいフォルダを読み込んだ状態で、入力欄右の **「☆」** をクリック（解除は **「★」** をクリック）
6. 削除は **設定（⚙）→「お気に入り」** から（即保存）

---

## 設定データの保存先

- 設定は `PropertiesService.getUserProperties()` に **ユーザー単位** で保存されます  
  - 同じWebアプリURLでも、見るユーザーが違えば設定は別になります

---

## トラブルシューティング

### Driveの一覧が取れない / 0件になる

- **フォルダID/URLが正しいか**（他人のフォルダはアクセス権が必要）
- **Drive API（高度なサービス）** と **Google Drive API（GCP側）** を有効化したか
- 共有ドライブは、組織ポリシーや権限で一覧取得が制限されることがあります

### 「共有ドライブ」だけ一覧取得できない

- 本アプリは `Drive.Drives.list()` を使用しますが、
  組織のポリシーやアカウント権限により取得できない場合があります。
- その場合でも、**共有ドライブ内の特定フォルダURLを直接入力して読み込む**
  方法は動作することがあります（権限次第）。
- 取得できない場合でも、UIは落とさず空として扱う設計です。

### プレビューが表示されない

- 対応していないファイル形式の可能性があります → 「新しいタブ」で開いてください
- そのファイルに閲覧権限が無い場合も表示できません

### ローカル（Cursor等）から同期したい場合：`clasp`（任意）

ブラウザでのコピペ運用が一番簡単ですが、ファイルをローカル管理したい場合は Google公式CLI の `clasp` が使えます。

- 前提
  - Node.js がインストール済み
  - 初回のみ `clasp` をインストール（グローバル）

```bash
npm i -g @google/clasp
clasp login
```

- 事前準備（必要な場合）
  - Apps Script エディタ → **プロジェクトの設定** で **「Apps Script API」** をON（項目が表示される場合）
  - うまくいかない場合は、GCP側で **Google Apps Script API** を有効化してください（環境によって必須になります）

- 既存のApps Scriptプロジェクトに、このリポジトリを紐付けたい場合（おすすめ）
  - Apps Script エディタ → **プロジェクトの設定** → **スクリプトID** をコピー
  - このリポジトリのフォルダで以下を実行し、`.clasp.json` を作成

```bash
clasp clone <スクリプトID>
```

補足：

- `clasp clone` は **ファイルをダウンロードして上書き** するため、既にこのリポジトリに変更がある場合は注意してください。
- 手元の `Code.gs` / `Index.html` を反映したい場合は、clone後に差し替えて `clasp push` します。

```bash
clasp push
```

---

## 変更の影響範囲・副作用・互換性破壊

- **このREADME更新はドキュメントのみの変更**で、アプリの動作には影響しません（互換性破壊なし）。

---

## ライセンス

MIT License

## 免責

本ツールの利用により生じたいかなる損害についても、
作者は責任を負いません。自己責任で利用してください。

## 非公式表記

本アプリは Google 公式プロダクトではありません。  
Google Drive / Google Apps Script は Google LLC の商標です。
